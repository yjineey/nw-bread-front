name: Deploy Newway Bread to GitHub Pages

on:
  push:
    branches: [main] # main ë¸Œëœì¹˜ì— pushë  ë•Œë§ˆë‹¤
  workflow_dispatch: # ìˆ˜ë™ìœ¼ë¡œ ì›Œí¬í”Œë¡œìš°ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  build:
    runs-on: ubuntu-latest # ë¹Œë“œ ì‘ì—…ì„ ìœ„í•œ í™˜ê²½ ì„¤ì •

    steps:
      - uses: actions/checkout@v4 # ì½”ë“œ ì²´í¬ì•„ì›ƒ

      - uses: actions/setup-node@v4
        with:
          node-version: '22'

      - run: corepack enable
      - run: corepack prepare pnpm@8.15.4 --activate # ë²„ì „ ê³ ì •

      # pnpmì´ ì„¤ì¹˜ëœ í›„ì— ìºì‹œ ì„¤ì •
      - uses: actions/cache@v3
        with:
          path: ~/.pnpm-store
          key: ${{ runner.os }}-pnpm-${{ hashFiles('**/pnpm-lock.yaml') }}
          restore-keys: |
            ${{ runner.os }}-pnpm-

      - run: pnpm install --frozen-lockfile
      - run: pnpm build
      - run: pnpm export # ğŸ‘ˆ next export ì‹¤í–‰ (í•„ìˆ˜)

      - uses: actions/upload-pages-artifact@v3 # ë¹Œë“œëœ íŒŒì¼ì„ GitHub Pagesì— ì—…ë¡œë“œ
        with:
          path: out # Next.js export ê²°ê³¼ë¬¼ ë””ë ‰í† ë¦¬

  deploy: # ë°°í¬ ì‘ì—…
    needs: build # build ì‘ì—…ì´ ì™„ë£Œëœ í›„ì— ì‹¤í–‰
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - id: deployment
        uses: actions/deploy-pages@v4 # GitHub Pagesì— ë°°í¬
